<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Load Testing, Scaling and Monitoring the Applications</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body id="scaling" class="article">
<div id="header">
<h1>Load Testing, Scaling and Monitoring the Applications</h1>
<div class="details">
<span id="revdate"></span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Our microservices have several endpoints consuming memory or CPU.
Depending on the number of iterations and bites we pass as parameters to these endpoints, it can take significantly longer to respond.
We are going to explore the problem by looking at CPU and memory metrics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cpu"><a class="anchor" href="#_cpu"></a>CPU</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you know CPU usage you are better prepared to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is the amount of CPU resources maxed out?</p>
</li>
<li>
<p>Have I over provisioned the amount of CPU resources?</p>
</li>
<li>
<p>What does the baseline of usage looks like?</p>
</li>
<li>
<p>Is there room to grow without scaling out or up?</p>
</li>
<li>
<p>How much of the available CPU resources is it really using?</p>
</li>
<li>
<p>What type of load is it?</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_memory"><a class="anchor" href="#_memory"></a>Memory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you know memory usage you are better prepared to answer the following questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is the amount of memory used close to the maximum available memory?</p>
</li>
<li>
<p>Have I over provisioned the amount of memory resources?</p>
</li>
<li>
<p>What does the baseline of usage look like?</p>
</li>
<li>
<p>Is there room to grow without scaling out or up?</p>
</li>
<li>
<p>How much of the available memory resources is it really using?</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the first thing you usually want to do once your application is deployed is to configure monitoring.
We&#8217;ll use the <a href="https://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure portal</a> to create a nice dashboard for monitoring our application metrics.</p>
</div>
<div class="paragraph">
<p>Open the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> and navigate to the resource group <code>rg-java-runtimes</code> you created for your application.
Select the <code>quarkus-app</code> container app, then select <strong>Metrics</strong> from the left menu, under the <strong>Monitoring</strong> group.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the metrics panel for the container app">
</div>
</div>
<div class="paragraph">
<p>Using the <strong>Metrics</strong> panel, you can select which metrics you want to observe, and the time range for the data.
Under the <em>Standard Metrics</em> namespace, you can see the list of available built-in metrics for your application.
You can also create <a href="https://learn.microsoft.com/azure/azure-monitor/essentials/metrics-custom-overview?WT.mc_id=javascript-0000-yolasors?">your own custom metrics</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the list of standard metrics">
</div>
</div>
<div class="paragraph">
<p>Select "<em>CPU Usage</em>" from the list of metrics, choose "<em>Max</em>" for the <strong>Aggregation</strong> and select the last 30 minutes for the time range (in the top right of the panel).
You can see the CPU and memory usage for your application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the list of standard metrics">
</div>
</div>
<div class="sect2">
<h3 id="_creating_charts_for_all_services"><a class="anchor" href="#_creating_charts_for_all_services"></a>Creating charts for all services</h3>
<div class="paragraph">
<p>Now let&#8217;s add the CPU metrics of the Micronaut and Spring apps to the same chart.
Select <strong>Add metric</strong> and select "<em>CPU Usage</em>" and aggregation "<em>Max</em>" again.
Then click on the <strong>Scope</strong> setting, unselect <code>quarkus-app</code> and pick the <code>micronaut-app</code>.
Select <strong>Apply</strong>, and repeat the same for the <code>spring-app</code>.</p>
</div>
<div class="paragraph">
<p>Now you should see a nice chart with the CPU usage of all three applications.
Let&#8217;s save this chart on the dashboard!</p>
</div>
<div class="paragraph">
<p>Select <strong>Save to dashboard</strong> and choose <strong>Pin to dashboard</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the save to dashboard options">
</div>
</div>
<div class="paragraph">
<p>In the <em>Pin to dashboard</em> dialog, select <strong>Create new</strong> and give it a name, for example "Java Runtimes" then click <strong>Create and pin</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the dashboard creation dialog">
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll also add charts to monitor the memory usage and number of replicas of our applications.</p>
</div>
<div class="paragraph">
<p>Click on <strong>+ New chart</strong> (top left corner) and repeat the same steps as before to create a chart with "<em>Memory Working Set Bytes</em>" metrics with aggregation "<em>Max</em>".
Do this for the three applications (Quarkus, Micronaut and Spring Boot).
Select <strong>Save to dashboard</strong>, choose <strong>Pin to dashboard</strong>, and select the existing "Java Runtimes" dashboard.</p>
</div>
<div class="paragraph">
<p>Click on <strong>+ New chart</strong> again, and create another chart with the "<em>Replica Count</em>" metric with aggregation "<em>Max</em>".
Don&#8217;t forget to save this dashboard as well (select <strong>Save to dashboard</strong>, choose <strong>Pin to dashboard</strong>, and select the existing "Java Runtimes" dashboard).</p>
</div>
<div class="paragraph">
<p>When you&#8217;re finished, in the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> sidebar select <strong>Dashboards</strong> and choose the "<em>Java Runtimes</em>" dashboard we created earlier.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of Azure portal dashboard selection">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Depending on your setup, you might see the Azure Portal sidebar menu or not.
If not, click on the burger menu at the very top left of the portal and you will see the Dashboard menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of Azure portal burger menu">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should now see the 3 charts you just created.
You can rearrange the charts by dragging them around, and resize them by dragging the bottom right corner.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of dashboard showing metrics for our applications">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logs"><a class="anchor" href="#_logs"></a>Logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> also provides a nice interface to view the logs of your application.
This is crucial to troubleshoot issues when something goes wrong.</p>
</div>
<div class="paragraph">
<p>You have multiple options to view the different logs of your application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can connect to a given container apps instance and gets the stream of console logs.
This is useful to troubleshoot issues with a specific instance of your application in real time.</p>
</li>
<li>
<p>You can also access the console logs in <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a>.
You get access to all logs from the <a href="https://learn.microsoft.com/azure/azure-monitor/logs/log-analytics-overview?WT.mc_id=javascript-0000-yolasors">Log Analytics</a> workspace we created earlier.
Using SQL-like queries (called <a href="https://learn.microsoft.com/azure/data-explorer/kusto/query?WT.mc_id=javascript-0000-yolasors">Kusto Query Language</a>, or KQL), you can filter the logs and get the information you need across all your applications, revisions, and instances.</p>
</li>
<li>
<p>Finally, you also have access to the <em>system logs</em>, which are the logs of the container host.
It&#8217;s very useful to troubleshoot issues with the container host itself and find out why your container is not running.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_streaming_logs_of_a_container_instance"><a class="anchor" href="#_streaming_logs_of_a_container_instance"></a>Streaming logs of a container instance</h3>
<div class="paragraph">
<p>The most straightforward way to access the logs of your application is to connect to a given container instance and get the stream of console logs.
You can directly access the stream of logs from the latest revision of a running instance of your application with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"> az containerapp logs show \
  --name "$QUARKUS_APP" \
  --resource-group "$RESOURCE_GROUP" \
  --format text \
  --follow</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget that by default, containers apps scale out to 0 instances when they are not used.
You can use the command <code>curl https://${QUARKUS_HOST}/quarkus</code> to wake up the container app first if the connections fails.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you&#8217;re connected, you can see the logs of your application in real time.
The <code>--follow</code> option keeps the connection open to see the new logs in real time.</p>
</div>
<div class="paragraph">
<p>In a different terminal, you can use the <code>curl</code> command to generate some load on the application.
You should see the logs of the application being updated in real time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl https://${QUARKUS_HOST}/quarkus/cpu?iterations=10</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_console_logs_in_azure_portal"><a class="anchor" href="#_viewing_the_console_logs_in_azure_portal"></a>Viewing the console logs in Azure portal</h3>
<div class="paragraph">
<p>You can also access the console logs in the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> or via CLI.
Using <a href="https://learn.microsoft.com/azure/azure-monitor/logs/log-analytics-overview?WT.mc_id=javascript-0000-yolasors">Log Analytics</a>, you get access to all logs from all your applications, revisions, and instances.
This means you can troubleshoot issues across all your applications, tracing requests as needed, which is crucial if your application use a microservices architecture.</p>
</div>
<div class="paragraph">
<p>Open the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> and navigate to the resource group <code>rg-java-runtimes</code> you created for your application.
Select the <code>logs-java-runtimes</code> container app, then select <strong>Logs</strong> from the left menu, under the <strong>General</strong> group.</p>
</div>
<div class="paragraph">
<p>By default, you are presented a list of pre-defined queries.
Close this panel by clicking on the <strong>X</strong> button on the top right corner, as we&#8217;ll create our own query.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the Azure portal showing the logs analytics panel">
</div>
</div>
<div class="paragraph">
<p>Log analytics queries use the <a href="https://docs.microsoft.com/azure/azure-monitor/log-query/query-language?WT.mc_id=javascript-0000-yolasors">Kusto query language</a>, which is a SQL-like language.
You can use the query language to filter the logs and get the information you need.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating a query to get the logs of the <code>quarkus-app</code> container app.
Enter this query in the editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">ContainerAppConsoleLogs_CL
| where RevisionName_s == "quarkus-app--&lt;REVISION_ID&gt;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get the app revision name by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">az containerapp revision list \
  --name "$QUARKUS_APP" \
  --resource-group "$RESOURCE_GROUP" \
  --query "[0].name" --output tsv</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select <strong>Run</strong> to execute the query.
You should see the logs of the <code>quarkus-app</code> container app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the logs results in Azure portal">
</div>
</div>
<div class="paragraph">
<p>For now, it&#8217;s not very useful as it&#8217;s the same logs we saw in the previous section.
Let&#8217;s add some filters to the query to search for error messages from the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">ContainerAppConsoleLogs_CL
| where RevisionName_s == "quarkus-app--&lt;REVISION_ID&gt;"
| where Log_s !has "INFO"
| where Log_s contains "error"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select <strong>Run</strong> to execute the query.
If your application is working fine, you should not see any results.
Let&#8217;s generate some errors by crashing the application with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl https://${QUARKUS_HOST}/quarkus/memory?bites=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Oops! We&#8217;re trying to allocate more memory than the container has available, resulting in a crash because of our (crude) memory allocation algorithm.</p>
</div>
<div class="paragraph">
<p>If you run the query again, you should see the error message in the logs:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the logs results in Azure portal">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Of course, you can go much further with the query language.
You can have a look at the <a href="https://learn.microsoft.com/azure/data-explorer/kql-quick-reference?WT.mc_id=javascript-0000-yolasors">quick reference</a> to play a bit with the queries.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can make it easier to read by making the latest logs appear at the top of the results, and only show the time and message of the last 10 logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">ContainerAppConsoleLogs_CL
| where RevisionName_s == "quarkus-app--&lt;REVISION_ID&gt;"
| where Log_s !has "INFO"
| where Log_s contains "error"
| project TimeGenerated, Log_s
| sort by TimeGenerated desc
| take 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here we can quickly see our <code>OutOfMemoryError</code> error message.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the logs results in Azure portal">
</div>
</div>
<div class="paragraph">
<p>We can save the query for later use by clicking on the <strong>Save</strong> button.
You can then give it a name and a description, and a category to quickly find it later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_console_logs_with_the_cli"><a class="anchor" href="#_viewing_the_console_logs_with_the_cli"></a>Viewing the console logs with the CLI</h3>
<div class="paragraph">
<p>You can also view the logs via a CLI command instead of using the portal.
It&#8217;s just a matter of writing any KQL query in the <code>analytics-query</code> parameter as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">az monitor log-analytics query \
--workspace $LOG_ANALYTICS_WORKSPACE_CLIENT_ID \
--analytics-query "ContainerAppConsoleLogs_CL | where RevisionName_s == 'quarkus-app--&lt;REVISION_ID&gt;'" \
--output table</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_the_system_logs"><a class="anchor" href="#_viewing_the_system_logs"></a>Viewing the system logs</h3>
<div class="paragraph">
<p>While console logs are very useful to troubleshoot issues with your application, it won&#8217;t be much help if your container is not running.
In this case, you need to troubleshoot the container host itself.
This is where the <em>system logs</em> come in handy.</p>
</div>
<div class="paragraph">
<p>The system logs are the logs of the container host.
They are very useful to troubleshoot issues with the container host itself and monitor its activity during provisioning operations.</p>
</div>
<div class="paragraph">
<p>System logs can be accessed the same way as console logs.
Change the previous query in the editor to get the system logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">ContainerAppSystemLogs_CL
| where RevisionName_s == "quarkus-app--&lt;REVISION_ID&gt;"
| project TimeGenerated, Reason_s, Log_s
| sort by TimeGenerated desc</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the system logs of the <code>quarkus-app</code> container app, covering the whole lifecycle of the container.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of the logs results in Azure portal">
</div>
</div>
<div class="paragraph">
<p>Using the CLI you can execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">az monitor log-analytics query \
--workspace $LOG_ANALYTICS_WORKSPACE_CLIENT_ID \
--analytics-query "ContainerAppSystemLogs_CL | where RevisionName_s == 'quarkus-app--&lt;REVISION_ID&gt;' | project TimeGenerated, Reason_s, Log_s | sort by TimeGenerated desc" \
--output table</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_load_testing"><a class="anchor" href="#_load_testing"></a>Load Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now it&#8217;s time to add some load to the application.
This will allow us to see how the auto-scaling features works in Azure Container Apps.</p>
</div>
<div class="paragraph">
<p>To add some load to an application, you can do it locally using <a href="https://jmeter.apache.org">JMeter</a>, but you can also do it remotely on Azure using <a href="https://azure.microsoft.com/services/load-testing?WT.mc_id=javascript-0000-yolasors">Azure Load Testing</a> and JMeter.</p>
</div>
<div class="paragraph">
<p>Azure Load Testing is a fully managed load-testing service built for Azure that makes it easy to generate high-scale load and identify app performance bottlenecks.
It is available on the <a href="https://azuremarketplace.microsoft.com/?WT.mc_id=javascript-0000-yolasors">Azure Marketplace</a>.</p>
</div>
<div class="sect2">
<h3 id="_setting_up_azure_load_testing"><a class="anchor" href="#_setting_up_azure_load_testing"></a>Setting up Azure Load Testing</h3>
<div class="paragraph">
<p>To use Azure Load Testing, go to the <a href="https://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a>, select <strong>Create a resource</strong> in the sidebar and search for "<em>Azure Load Testing</em>".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of searching for Azure Load Testing in Azure Portal">
</div>
</div>
<div class="paragraph">
<p>1.
Select <strong>Create</strong>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Azure Load Testing creation screen">
</div>
</div>
<div class="paragraph">
<p>2.
In the <strong>Resource group</strong> field, select the <code>rg-java-runtimes</code> that we created previously.</p>
</div>
<div class="paragraph">
<p>3.
Set the name <code>lt-java-runtimes-&lt;Your unique identifier&gt;</code> for the load testing instance (the name has to be unique).</p>
</div>
<div class="paragraph">
<p>4.
Set the location to match your previously created resources (West Europe).</p>
</div>
<div class="paragraph">
<p>5.
Select <strong>Review + Create</strong>, then <strong>Create</strong>.</p>
</div>
<div class="paragraph">
<p>Creating a load testing resource can take a few moment.
Once created, you should see the Azure Load Testing available in your resource group:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of Azure Load Testing in Resource group">
</div>
</div>
<div class="paragraph">
<p>Select <code>lt-java-runtimes-&lt;your_id&gt;</code>, and then click on <strong>Tests</strong> and then <strong>Create</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of test creation">
</div>
</div>
<div class="paragraph">
<p>1.
You can either create a quick load test using a wizard, or create a load test using a JMeter script.
Choose this second option.</p>
</div>
<div class="paragraph">
<p>2.
Before uploading a JMeter script, create a load test by entering a name (eg. "<em>Add some load</em>"), a description and click on the "Test plan" tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of test setup">
</div>
</div>
<div class="paragraph">
<p>3.
Now that you are on the "Test plan" tab, you can upload the JMeter file (located under <code>scripts/jmeter/src/test/jmeter/load.jmx</code>) as well as the <code>user.properties</code> file.
The JMeter file sets up a load campaign targeting the various endpoints.</p>
</div>
<div class="paragraph">
<p>But before uploading the <code>user.properties</code> file, make sure you change the properties (<code>QUARKUS_HOST</code>, <code>SPRING_HOST</code> and <code>MICRONAUT_HOST</code>) to match your deployed applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">LOOPS=50
THREADS=16
RAMP=1
CPU_ITERATIONS=5
MEMORY_BITES=20

# Put your quarkus host here
QUARKUS_HOST=&lt;Your QUARKUS_HOST&gt;
QUARKUS_PROTOCOL=https
QUARKUS_PORT=443

# Put your spring host here
SPRING_HOST=&lt;Your SPRING_HOST&gt;
SPRING_PROTOCOL=https
SPRING_PORT=443

# Put your micronaut host here
MICRONAUT_PROTOCOL=https
MICRONAUT_HOST=&lt;Your MICRONAUT_HOST&gt;
MICRONAUT_PORT=443</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re using GitHub Codespaces, you need to right-click on the <code>load.jmx</code> and <code>user.properties</code> files and select <strong>Download&#8230;&#8203;</strong> first to get the files before uploading them to Azure Load Testing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4.
Select <strong>Upload</strong>, and choose "<em>User properties</em>" in the <strong>File relevance</strong> field of the <code>user.properties</code> file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of test plan setup">
</div>
</div>
<div class="paragraph">
<p>5.
Select <strong>Review + Create</strong>, then <strong>Create</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_tests"><a class="anchor" href="#_running_the_tests"></a>Running the tests</h3>
<div class="paragraph">
<p>After the test creation, it will start automatically after a short time.
When the test run finishes, you will get some metrics:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of test run">
</div>
</div>
<div class="paragraph">
<p>In the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> sidebar, select <strong>Dashboards</strong> and go back to the "<em>Java Runtimes</em>" dashboard we created earlier.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>There might be a slight delay before the metrics are visible in the dashboard.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you take a look at the charts, you can see CPU and memory usage increase, and also that the number of replicas has increased from 1 replica to 10.
Azure Container Apps has scaled automatically the application depending on the load.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of dashboard showing load testing results">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scaling"><a class="anchor" href="#_scaling"></a>Scaling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have seen the auto-scaling in action, let&#8217;s dive a bit into fine-tuning its configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Azure Container Apps only support automatic <em>horizontal</em> scaling, meaning that it will only scale the number of replicas of your application.
Vertical scaling (increasing the amount of available CPU and memory) is supported, but you need to do it manually.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Azure Container Apps support different types of <a href="https://learn.microsoft.com/azure/container-apps/scale-app?WT.mc_id=javascript-0000-yolasors">scaling rules</a>, implemented using the KEDA <a href="https://keda.sh/docs/concepts/scaling-deployments/#scaledobject-spec">Scaling Object</a>.
It supports the following triggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>HTTP traffic</em>: Scaling based on the number of concurrent HTTP requests to your revision.
This is the default scaling rule.</p>
</li>
<li>
<p><em>TCP traffic</em>: Scaling based on the number of concurrent TCP requests to your revision.</p>
</li>
<li>
<p><em>Event-driven</em>: Event-based triggers such as messages in an Azure Service Bus.</p>
</li>
<li>
<p><em>CPU</em> or <em>Memory usage</em>: Scaling based on the amount of CPU or memory consumed by a replica.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, when you deploy a container app, it is set to scale from 0 to 10 replicas. The default scaling rule uses HTTP scaling and defaults to a minimum of 10 concurrent requests per second.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As our applications provides endpoints to load either the CPU or the memory, we will explore usage of the <em>CPU</em> and <em>Memory usage</em> triggers to scale our application.</p>
</div>
<div class="sect2">
<h3 id="_scaling_based_on_cpu_usage"><a class="anchor" href="#_scaling_based_on_cpu_usage"></a>Scaling based on CPU usage</h3>
<div class="paragraph">
<p>To scale based on CPU usage, we need to update the scale rule of the application to use the <code>cpu</code> trigger.
This will create a new revision of the application (but the URL <code>$QUARKUS_HOST</code> remains unchanged), and will start a new deployment.</p>
</div>
<div class="paragraph">
<p>We will set a new scale rule for our Quarkus app using the Azure CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Unresolved directive in scaling.adoc - include::{project-root}/scripts/infra/scale.sh[tag=adocAutoScalingCpu, indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically scale out the application when the CPU usage is above 10% (we set it low deliberately to make it easy to go up).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of setting up CPU scaler">
</div>
</div>
<div class="paragraph">
<p>Go back to the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a>, and search for <code>lt-java-runtimes</code> to open again our load testing instance.
Select <strong>Tests</strong> in the left sidebar, open the test we created earlier and select <strong>Run</strong> to run the load tests again.</p>
</div>
<div class="paragraph">
<p>Once the test is finished, go back to the "<em>Java Runtimes</em>" dashboard and take a look at the number of replicas chart again.
You should see that the number of replicas has increased to 10, and that the CPU usage has increased as well.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of dashboard showing CPU scaler results">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using either the <em>CPU</em> or <em>Memory usage</em> triggers, the minimum number of replicas will always be 1.
Use HTTP or event based triggers to allow scaling to 0.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_based_on_memory_usage"><a class="anchor" href="#_scaling_based_on_memory_usage"></a>Scaling based on memory usage</h3>
<div class="paragraph">
<p>Another option that we can use is to scale based on the memory usage, with the <code>memory</code> trigger.</p>
</div>
<div class="paragraph">
<p>This we will set the scale rule for our Micronaut app using the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">Unresolved directive in scaling.adoc - include::{project-root}/scripts/infra/scale.sh[tag=adocAutoScalingMemory, indent=0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically scale out the application when the memory usage is above 15% (we set it low deliberately to make it easy to go up).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of setting up memory scaler">
</div>
</div>
<div class="paragraph">
<p>Again, go back to the <a href="http://portal.azure.com/?WT.mc_id=javascript-0000-yolasors">Azure Portal</a> and run the load tests again.
Open the dashboard when the test is finished, and take a look at the number of replicas chart again.</p>
</div>
<div class="paragraph">
<p>You can now compare how the CPU (Quarkus), memory (Micronaut), and HTTP (Spring) triggers behave when scaling the application, under the same load.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64," alt="Screenshot of dashboard showing CPU scaler results">
</div>
</div>
<div class="paragraph">
<p>As you can see, using different scaling triggers allows to tune the scaling behavior of your application, depending on the type of load you want to handle.
Note that you&#8217;re not limited to only one scaling trigger, you can use multiple triggers at the same time.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Fine tuning the scaling rules is a key factor to get the best performance/cost ratio for your application.
You want to make sure that you don&#8217;t scale too early, and that you don&#8217;t scale too much to avoid paying for resources that are not needed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_checking_the_metrics_in_the_database"><a class="anchor" href="#_checking_the_metrics_in_the_database"></a>Checking the Metrics in the Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Remember that we have a PostgreSQL Database with three tables where we store our metrics.
You can execute the following SQL statements so you get all the metrics for Quarkus, Micronaut and Spring Boot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">az postgres flexible-server execute \
  --name "$POSTGRES_DB" \
  --admin-user "$POSTGRES_DB_ADMIN" \
  --admin-password "$POSTGRES_DB_PWD" \
  --database-name "$POSTGRES_DB_SCHEMA" \
  --querytext "select Duration, Parameter, Description from Statistics_Quarkus" \
  --output table

az postgres flexible-server execute \
  --name "$POSTGRES_DB" \
  --admin-user "$POSTGRES_DB_ADMIN" \
  --admin-password "$POSTGRES_DB_PWD" \
  --database-name "$POSTGRES_DB_SCHEMA" \
  --querytext "select Duration, Parameter, Description from Statistics_Micronaut" \
  --output table

az postgres flexible-server execute \
  --name "$POSTGRES_DB" \
  --admin-user "$POSTGRES_DB_ADMIN" \
  --admin-password "$POSTGRES_DB_PWD" \
  --database-name "$POSTGRES_DB_SCHEMA" \
  --querytext "select Duration, Parameter, Description from Statistics_Springboot" \
  --output table</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-02-21 14:16:24 UTC
</div>
</div>
</body>
</html>